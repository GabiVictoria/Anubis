{% extends 'principal/base.html' %}
{% load static %}
{% load i18n %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'principal/perfil.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block content %}
  <div class="perfil-container">
    <div class="capa">
      <img src="{% if usuario.foto_capa %}{{ usuario.foto_capa.url }}{% else %}{% static 'img/default_cover.jpg' %}{% endif %}" alt="{% trans 'Foto de capa' %}">
    </div>

    <div class="perfil-informacoes">
      <div class="foto-perfil">
       <img src="{% if usuario.foto_perfil %}{{ usuario.foto_perfil.url }}{% else %}{% static 'img/Logo..png' %}{% endif %}" alt="{% trans 'Foto de perfil' %}" />
      </div>
      <div class="dados-perfil">
        <div class="titulo-drop">
          <h1 class="nome">{{usuario.nome}}</h1>
          
          <div class="language-dropdown">
              <button class="language-globe-button" onclick="toggleLanguageMenu()">
                  <i class="fas fa-globe"></i>
              </button>
              <div id="language-menu" class="dropdown-content">
                  {% get_available_languages as LANGUAGES %}
                  {% for lang_code, lang_name in LANGUAGES %}
                      <form action="{% url 'set_language' %}" method="post" class="language-form">
                          {% csrf_token %}
                          <input name="next" type="hidden" value="{{ request.get_full_path }}">
                          <input name="language" type="hidden" value="{{ lang_code }}">
                          <button type="submit">{{ lang_name }}</button>
                      </form>
                  {% endfor %}
              </div>
          </div>
        </div>
        <p class="user-id"><strong>ID:</strong> {{ usuario.unique_id }}</p>
        <p class="descricao">{{ usuario.bio|default:_("Nenhuma bio adicionada.") }}</p> 
        <div class="botoes">
          <a href="{% url 'principal:estante_pessoal' %}" class="azul">{% trans "Estante pessoal" %}</a>
          <button class="azul">{% trans "Convites" %}</button>
          <button class="azul" >{% trans "Meus clubes" %}</button>
          <a href="{% url 'principal:editar_perfil' %}" class="borda">{% trans "Editar perfil" %}</a>
        </div>
        </div>
      </div>
    </div>
  </div>

<div class="livros-recentes">
    <h2>📚 {% trans "Livros lidos recentemente" %}</h2>
    <div class="livros-galeria">
      {% for item_estante in livros_lidos_recentemente %}
        <div class="livro-card">
          <img src="{% if item_estante.livro.capa %}{{ item_estante.livro.capa.url }}{% else %}{% static 'img/sem_capa.png' %}{% endif %}" alt="{{ item_estante.livro.nome }}">
          <h3>{{ item_estante.livro.nome }}</h3>
          <p>{{ item_estante.livro.autor }}</p>
          {% if item_estante.clube %}
          <p class="clube quebra-linha">{% trans "Clube:" %} {{ item_estante.clube.nome }}</p>
          {% endif %}
          {% if item_estante.nota_pessoal %}
          <p class="nota">{% trans "Sua nota:" %} ⭐ {{ item_estante.nota_pessoal }}</p>
          {% endif %}
        </div>
      {% empty %}
        <p class="sem-livros-msg">{% trans "Você ainda não finalizou nenhuma leitura. Continue lendo!" %}</p>
      {% endfor %}
    </div>
  </div>


    <section class="clubes-recentes">
    <h2>📚 {% trans "Clubes Que Você Entrou Recentemente" %}</h2>
    <div class="clubes-galeria">
      
      {% for item in clubes_recentes %}
        <div class="clube-card">
           <a href="{% url 'principal:detalhes_clube' item.clube_obj.id %}" class="ver-clube-btn">
          {% if item.clube_obj.capa_clube %}
            <img src="{{ item.clube_obj.capa_clube.url }}" alt="{% trans 'Capa do clube' %} {{ item.clube_obj.nome }}" />
          {% elif item.clube_obj.capa_recomendada %}
            <img src="{% static item.clube_obj.capa_recomendada %}" alt="{% trans 'Capa do clube' %} {{ item.clube_obj.nome }}" />
          {% else %}
            <img src="{% static 'img/imgideal.png' %}" alt="{% trans 'Capa padrão' %}" />
          {% endif %}</a>
          
          <h3>{{ item.clube_obj.nome }}</h3>
          
          <p class="admin-info">
              <strong>{% trans "Admin:" %}</strong>
              <span>{{ item.admin_nome|default:_("N/D") }}</span>
          </p>
          <p><strong>{% trans "Criado em:" %}</strong> {{ item.clube_obj.data_criacao|date:"d/m/Y" }}</p>
          <p><strong>{% trans "Você entrou em:" %}</strong> {{ item.data_entrada|date:"d/m/Y" }}</p>
          
          <p class="book-info"><strong>📖 {% trans "Livro atual:" %}</strong> {{ item.livro_atual|default:_("Não definido") }}</p>
          <p class="book-info"><strong>📘 {% trans "Próximo livro:" %}</strong> {{ item.proximo_livro|default:_("Não definido") }}</p>
        </div>
      {% empty %}
        <p class="sem-clubes-msg">{% trans "Você ainda não faz parte de nenhum clube. Que tal explorar alguns?" %}</p>
      {% endfor %}

    </div>
  </section>
{% endblock %}
 
{% block scripts %}
<script>
  
    function toggleLanguageMenu() {
        document.getElementById("language-menu").classList.toggle("show");
    }

    window.onclick = function(event) {
        if (!event.target.matches('.language-globe-button') && !event.target.matches('.fa-globe')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
  </script>
{% endblock %}
  
